// URL Bar Component
// Contains method selector, URL input, and Send/Cancel button

import { LineEdit } from "std-widgets.slint";
import { VortexPalette, VortexTypography, VortexSpacing } from "../theme.slint";
import { MethodSelector } from "method_selector.slint";

export component UrlBar inherits Rectangle {
    in-out property <string> url: "";
    in-out property <int> method-index: 0;
    in property <bool> is-loading: false;
    in property <[string]> methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"];

    callback send-clicked();
    callback cancel-clicked();
    callback method-changed(string);
    callback url-changed(string);

    height: 48px;
    background: VortexPalette.bg-secondary;

    HorizontalLayout {
        padding: VortexSpacing.sm;
        spacing: VortexSpacing.sm;

        MethodSelector {
            current-index <=> method-index;
            methods: root.methods;
            method-changed(m) => { root.method-changed(m); }
        }

        Rectangle {
            horizontal-stretch: 1;
            background: VortexPalette.bg-input;
            border-radius: 4px;
            border-width: 1px;
            border-color: url-input.has-focus ? VortexPalette.border-focus : VortexPalette.border-default;

            url-input := LineEdit {
                text <=> url;
                placeholder-text: "Enter URL (e.g., https://api.example.com/users)";
                font-size: VortexTypography.font-base;

                accepted => {
                    if !is-loading {
                        send-clicked();
                    }
                }

                edited => {
                    url-changed(self.text);
                }
            }
        }

        if !is-loading: Rectangle {
            width: 80px;
            height: 32px;
            background: VortexPalette.button-primary;
            border-radius: 4px;

            states [
                hover when send-touch.has-hover: {
                    background: VortexPalette.button-primary-hover;
                }
            ]

            Text {
                text: "Send";
                color: white;
                font-size: VortexTypography.font-base;
                font-weight: VortexTypography.weight-medium;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            send-touch := TouchArea {
                clicked => {
                    send-clicked();
                }
            }
        }

        if is-loading: Rectangle {
            width: 80px;
            height: 32px;
            background: VortexPalette.status-error;
            border-radius: 4px;

            states [
                hover when cancel-touch.has-hover: {
                    background: #d43d3d;
                }
            ]

            Text {
                text: "Cancel";
                color: white;
                font-size: VortexTypography.font-base;
                font-weight: VortexTypography.weight-medium;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            cancel-touch := TouchArea {
                clicked => {
                    cancel-clicked();
                }
            }
        }
    }
}
