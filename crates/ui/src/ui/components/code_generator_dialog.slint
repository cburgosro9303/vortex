// Code Generator Dialog
// Shows generated code snippets for the current request in various languages

import { ScrollView, ComboBox } from "std-widgets.slint";
import { VortexPalette, VortexTypography, VortexSpacing, VortexShape } from "../theme.slint";

export component CodeGeneratorDialog inherits Rectangle {
    in property <bool> visible: false;
    in property <string> code: "";
    in property <int> language-index: 0;
    in property <[string]> languages: [
        "cURL",
        "Python (requests)",
        "JavaScript (fetch)",
        "JavaScript (axios)",
        "TypeScript (fetch)",
        "Rust (reqwest)",
        "Go (net/http)",
        "Java (HttpClient)",
        "C# (HttpClient)",
        "PHP (cURL)",
        "Ruby (Net::HTTP)",
        "Swift (URLSession)",
        "Kotlin (OkHttp)"
    ];
    in property <bool> copied: false;

    callback close();
    callback language-changed(int);
    callback copy-code();

    // Semi-transparent backdrop
    Rectangle {
        width: 100%;
        height: 100%;
        background: #00000080;
        visible: root.visible;

        TouchArea {
            clicked => { close(); }
        }
    }

    // Dialog container
    if visible: Rectangle {
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
        width: min(800px, parent.width - 40px);
        height: min(600px, parent.height - 80px);
        background: VortexPalette.bg-elevated;
        border-radius: VortexShape.radius-lg;
        border-width: 1px;
        border-color: VortexPalette.border-default;
        drop-shadow-blur: 20px;
        drop-shadow-color: #00000040;
        drop-shadow-offset-y: 4px;

        VerticalLayout {
            padding: 0;

            // Header
            Rectangle {
                height: 56px;
                background: VortexPalette.bg-secondary;
                border-radius: VortexShape.radius-lg;

                HorizontalLayout {
                    padding-left: VortexSpacing.lg;
                    padding-right: VortexSpacing.md;
                    alignment: space-between;

                    HorizontalLayout {
                        spacing: VortexSpacing.md;
                        alignment: center;

                        Text {
                            text: "Generate Code";
                            color: VortexPalette.text-primary;
                            font-size: VortexTypography.font-lg;
                            font-weight: VortexTypography.weight-bold;
                            vertical-alignment: center;
                        }

                        // Language selector
                        ComboBox {
                            width: 180px;
                            model: languages;
                            current-index <=> language-index;
                            selected(value) => {
                                language-changed(self.current-index);
                            }
                        }
                    }

                    // Close button
                    Rectangle {
                        width: 32px;
                        height: 32px;
                        border-radius: VortexShape.radius-sm;
                        background: close-touch.has-hover ? VortexPalette.bg-hover : transparent;

                        Text {
                            text: "x";
                            color: VortexPalette.text-secondary;
                            font-size: VortexTypography.font-lg;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        close-touch := TouchArea {
                            clicked => { close(); }
                        }
                    }
                }
            }

            // Separator
            Rectangle {
                height: 1px;
                background: VortexPalette.border-default;
            }

            // Code area
            Rectangle {
                vertical-stretch: 1;
                background: VortexPalette.bg-primary;

                ScrollView {
                    viewport-width: self.width;

                    Rectangle {
                        min-height: parent.visible-height;
                        background: VortexPalette.bg-input;

                        code-text := Text {
                            x: VortexSpacing.md;
                            y: VortexSpacing.md;
                            width: parent.width - VortexSpacing.lg;
                            text: code;
                            color: VortexPalette.text-primary;
                            font-size: VortexTypography.code-font-size;
                            font-family: "monospace";
                            wrap: word-wrap;
                            overflow: elide;
                        }
                    }
                }
            }

            // Footer with actions
            Rectangle {
                height: 60px;
                background: VortexPalette.bg-secondary;

                HorizontalLayout {
                    padding: VortexSpacing.md;
                    alignment: end;
                    spacing: VortexSpacing.sm;

                    // Copy button
                    Rectangle {
                        width: 120px;
                        height: 36px;
                        background: copied ? VortexPalette.status-success : (copy-touch.has-hover ? VortexPalette.accent-hover : VortexPalette.accent);
                        border-radius: VortexShape.radius-sm;

                        HorizontalLayout {
                            alignment: center;
                            spacing: VortexSpacing.xs;

                            Text {
                                text: copied ? "\u{2713}" : "";
                                color: white;
                                font-size: VortexTypography.font-sm;
                                vertical-alignment: center;
                            }

                            Text {
                                text: copied ? "Copied!" : "Copy Code";
                                color: white;
                                font-size: VortexTypography.font-sm;
                                font-weight: VortexTypography.weight-bold;
                                vertical-alignment: center;
                            }
                        }

                        copy-touch := TouchArea {
                            clicked => { copy-code(); }
                        }
                    }

                    // Close button
                    Rectangle {
                        width: 80px;
                        height: 36px;
                        background: close-btn-touch.has-hover ? VortexPalette.bg-hover : VortexPalette.bg-tertiary;
                        border-radius: VortexShape.radius-sm;
                        border-width: 1px;
                        border-color: VortexPalette.border-default;

                        Text {
                            text: "Close";
                            color: VortexPalette.text-secondary;
                            font-size: VortexTypography.font-sm;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        close-btn-touch := TouchArea {
                            clicked => { close(); }
                        }
                    }
                }
            }
        }
    }
}
