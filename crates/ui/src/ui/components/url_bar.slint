// URL Bar Component
// Postman-style URL bar with method selector, URL input, and Send button

import { LineEdit, ComboBox } from "std-widgets.slint";
import { VortexPalette, VortexTypography, VortexSpacing, VortexShape, VortexLayout } from "../theme.slint";

export component UrlBar inherits Rectangle {
    in-out property <string> url: "";
    in-out property <int> method-index: 0;
    in property <bool> is-loading: false;
    in property <[string]> methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"];

    callback send-clicked();
    callback cancel-clicked();
    callback method-changed(string);
    callback url-changed(string);

    height: VortexLayout.url-bar-height;
    background: VortexPalette.bg-secondary;

    // Bottom border only effect
    Rectangle {
        x: 0;
        y: parent.height - 1px;
        width: parent.width;
        height: 1px;
        background: VortexPalette.border-default;
    }

    HorizontalLayout {
        padding: VortexSpacing.md;
        spacing: VortexSpacing.sm;

        // Combined method + URL input field (Postman style)
        Rectangle {
            horizontal-stretch: 1;
            height: 36px;
            background: VortexPalette.bg-tertiary;
            border-radius: VortexShape.radius-md;
            border-width: 1px;
            border-color: url-input.has-focus ? VortexPalette.text-primary : VortexPalette.border-strong;

            HorizontalLayout {
                spacing: 0px;

                // Method selector
                Rectangle {
                    width: 100px;
                    background: method-touch.has-hover ? VortexPalette.bg-hover : transparent;

                    // Right border separator
                    Rectangle {
                        x: parent.width - 1px;
                        y: 0;
                        width: 1px;
                        height: parent.height;
                        background: VortexPalette.border-strong;
                    }

                    HorizontalLayout {
                        padding-left: VortexSpacing.md;
                        padding-right: VortexSpacing.sm;
                        alignment: space-between;

                        Text {
                            text: method-index >= 0 && method-index < methods.length ? methods[method-index] : "GET";
                            font-size: VortexTypography.font-md;
                            font-weight: VortexTypography.weight-semibold;
                            color: method-index == 0 ? VortexPalette.method-get :      // GET
                                   method-index == 1 ? VortexPalette.method-post :     // POST
                                   method-index == 2 ? VortexPalette.method-put :      // PUT
                                   method-index == 3 ? VortexPalette.method-patch :    // PATCH
                                   method-index == 4 ? VortexPalette.method-delete :   // DELETE
                                   method-index == 5 ? VortexPalette.method-head :     // HEAD
                                   VortexPalette.method-options;                        // OPTIONS
                            vertical-alignment: center;
                        }

                        // Dropdown chevron
                        Text {
                            text: "\u{25BE}";  // Down triangle
                            font-size: VortexTypography.font-xs;
                            color: VortexPalette.text-muted;
                            vertical-alignment: center;
                        }
                    }

                    method-touch := TouchArea {
                        clicked => {
                            // Cycle through methods on click (simplified)
                            method-index = mod(method-index + 1, methods.length);
                            method-changed(methods[method-index]);
                        }
                    }
                }

                // URL input
                url-input := LineEdit {
                    horizontal-stretch: 1;
                    text <=> url;
                    placeholder-text: "Enter request URL";
                    font-size: VortexTypography.font-md;

                    accepted => {
                        if !is-loading {
                            send-clicked();
                        }
                    }

                    edited => {
                        url-changed(self.text);
                    }
                }
            }
        }

        // Send / Cancel button
        Rectangle {
            width: 90px;
            height: 36px;
            background: is-loading ? VortexPalette.status-error :
                        (send-touch.has-hover ? VortexPalette.accent-hover : VortexPalette.accent);
            border-radius: VortexShape.radius-md;
            opacity: is-loading ? (cancel-touch.has-hover ? 1.0 : 0.9) : 1.0;

            Text {
                text: is-loading ? "Cancel" : "Send";
                color: VortexPalette.text-inverse;
                font-size: VortexTypography.font-md;
                font-weight: VortexTypography.weight-semibold;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            send-touch := TouchArea {
                visible: !is-loading;
                clicked => { send-clicked(); }
            }

            cancel-touch := TouchArea {
                visible: is-loading;
                clicked => { cancel-clicked(); }
            }
        }
    }
}
